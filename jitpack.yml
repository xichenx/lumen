# JitPack 构建配置
# JitPack 会自动检测此文件并按照配置构建
jdk:
  - openjdk11

before_install:
  - ./gradlew wrapper --gradle-version 8.5

# 构建所有需要发布的模块
# 使用聚合任务提高构建效率，Gradle 会自动处理依赖关系
# 如果聚合任务不可用，回退到单独发布每个模块
build:
  commands:
    - ./gradlew clean
    - |
      if ./gradlew tasks --all 2>/dev/null | grep -q "publishAllToMavenLocal"; then
        echo "Using aggregated publish task..."
        ./gradlew publishAllToMavenLocal --parallel --max-workers=4
      else
        echo "Using individual publish tasks..."
        ./gradlew :lumen-core:publishToMavenLocal :lumen-transform:publishToMavenLocal :lumen-view:publishToMavenLocal :lumen:publishToMavenLocal --parallel --max-workers=4
      fi

